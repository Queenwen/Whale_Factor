# Whale Effect Analysis Project

## Project Description

This project aims to analyze the "whale effect" in the cryptocurrency market. It covers data preparation, construction of various financial factors (e.g., based on top holders' holdings, large transaction counts/volumes), factor effectiveness validation (such as Information Coefficient (IC) analysis, quantile analysis), and backtesting of trading strategies based on these factors.

## Key Features

*   Process and construct factors from raw cryptocurrency data.
*   Comprehensive factor effectiveness validation, including Information Coefficient (IC) analysis and quantile analysis.
*   Multi-factor backtesting engine with detailed performance metrics calculation (e.g., Sharpe ratio, maximum drawdown).
*   Trading strategy analysis using lagged regression models (for individual tokens and pooled data).
*   Generate various charts and CSV summary files for the analysis process.

## Project Structure
hale_effect/
├── main.py                     # Main script to run the entire analysis process or specific stages
├── analysisagent.py            # Handles data loading, preprocessing, and main factor construction from raw data
├── factor_validation_agent.py  # Performs factor effectiveness analysis, including IC calculation and quantile sorting
├── backtest_agent.py           # Implements trading strategy backtesting logic based on selected factors
├── trading_strategy_agent.py   # Conducts in-depth trading strategy analysis using lagged regression models, etc.
├── config.py                   # Stores configuration parameters, such as API keys, file paths, token lists, and metric definitions
├── whale_effect_common_tokens.csv # (Example) Common tokens list file
├── data/                         # (Recommended) Directory to store input data files
│   ├── token_prices/
│   └── processed_no_high_missing/
├── intermediate_steps/         # Intermediate CSV files generated by AnalysisAgent
├── factor_validation_outputs/  # Outputs from factor validation and some trading strategy analysis (charts, CSV)
├── multifactor_strategy_outputs/ # Outputs related to backtesting (charts, CSV)
└── README.md                   # This file


*   <mcfile name="main.py" path="/Users/queenwen/Desktop/whale_effect/main.py"></mcfile>: Main script to run the entire analysis process or specific stages.
*   <mcfile name="analysisagent.py" path="/Users/queenwen/Desktop/whale_effect/analysisagent.py"></mcfile>: Handles data loading, preprocessing, and main factor construction from raw data.
*   <mcfile name="factor_validation_agent.py" path="/Users/queenwen/Desktop/whale_effect/factor_validation_agent.py"></mcfile>: Performs factor effectiveness analysis, including IC calculation and quantile sorting.
*   <mcfile name="backtest_agent.py" path="/Users/queenwen/Desktop/whale_effect/backtest_agent.py"></mcfile>: Implements trading strategy backtesting logic based on selected factors.
*   <mcfile name="trading_strategy_agent.py" path="/Users/queenwen/Desktop/whale_effect/trading_strategy_agent.py"></mcfile>: Conducts in-depth trading strategy analysis using lagged regression models, etc.
*   <mcfile name="config.py" path="/Users/queenwen/Desktop/whale_effect/config.py"></mcfile>: Stores configuration parameters, such as API keys, file paths, token lists, and metric definitions.
*   `data/` (Recommended to create this directory): Used to store input data files.
*   Output directories (e.g., `factor_validation_outputs`, `multifactor_strategy_outputs`, `intermediate_steps`): Used to store generated reports, charts, and CSV files.

## Environment Setup and Installation

1.  **Clone the Repository**
    ```bash
    git clone <your-repository-url>
    cd whale_effect
    ```

2.  **Environment Configuration**
    *   Recommended using Conda:
        ```bash
        conda create --name whale_effect python=3.8  # or a compatible newer version
        conda activate whale_effect
        ```
    *   Or create a virtual environment using pip:
        ```bash
        python -m venv venv
        source venv/bin/activate  # macOS/Linux
        # venv\Scripts\activate    # Windows
        ```

3.  **Install Dependencies**
    It is recommended to create a `requirements.txt` file. You can create it manually or generate it after setting up the environment using:
    ```bash
    pip freeze > requirements.txt
    ```
    Then install dependencies using:
    ```bash
    pip install -r requirements.txt
    ```
    If `requirements.txt` is not created yet, you can directly install the necessary libraries:
    ```bash
    pip install pandas numpy matplotlib statsmodels seaborn scipy
    ```

4.  **Configuration**
    *   Update the <mcfile name="config.py" path="/Users/queenwen/Desktop/whale_effect/config.py"></mcfile> file as needed, especially the `SANTIMENT_API_KEY` and any custom file paths.
    *   Ensure input data files (such as price data, whale data, common token list `whale_effect_common_tokens.csv`) are placed in the expected locations, or correctly specified in <mcfile name="config.py" path="/Users/queenwen/Desktop/whale_effect/config.py"></mcfile> or via command-line arguments.

## Usage Instructions

The main entry point of the project is <mcfile name="main.py" path="/Users/queenwen/Desktop/whale_effect/main.py"></mcfile>.

*   **Run the Full Analysis Process**:
    ```bash
    python main.py --stage all
    ```
    This will sequentially execute data preparation, factor construction, factor validation, strategy backtesting, and trading strategy analysis.

*   **Run Specific Stages**:
    *   Only perform data preparation and factor construction (outputs `analysis_results.csv`):
        ```bash
        python main.py --stage data_prep
        ```
    *   Only perform factor validation and strategy analysis (assuming `analysis_results.csv` and `whale_effect_common_tokens.csv` already exist):
        ```bash
        python main.py --stage analysis --data-file analysis_results.csv --tokens-file whale_effect_common_tokens.csv
        ```
        (Provide full or relative paths if files are not in the project root directory)

*   **Command-line Arguments for <mcfile name="main.py" path="/Users/queenwen/Desktop/whale_effect/main.py"></mcfile>**:
    *   `--data-file`: Path to the analysis data CSV file (usually the output of <mcfile name="analysisagent.py" path="/Users/queenwen/Desktop/whale_effect/analysisagent.py"></mcfile>). If not provided, the script may use a default path.
    *   `--tokens-file`: Path to the CSV file containing the common token list. If not provided, the script may use a default path (`whale_effect_common_tokens.csv`).
    *   `--output-dir`: (Optional) Specify the base directory for outputs. Each Agent will still use its specific subdirectory.
    *   `--stage`: Specify the part of the process to run (`data_prep`, `analysis`, `all`). Default is `all`.

*   **Run Agent Scripts Individually**:
    For more granular control, you can also run individual Agent scripts (e.g., <mcfile name="analysisagent.py" path="/Users/queenwen/Desktop/whale_effect/analysisagent.py"></mcfile>, <mcfile name="backtest_agent.py" path="/Users/queenwen/Desktop/whale_effect/backtest_agent.py"></mcfile>), which typically support their own command-line arguments. Refer to the `main()` function section in each script for details.

## Configuration Details

*   All major configuration parameters are centralized in the <mcfile name="config.py" path="/Users/queenwen/Desktop/whale_effect/config.py"></mcfile> file. This includes:
    *   API endpoints and keys (e.g., `SANTIMENT_API_KEY`).
    *   List of tokens to analyze (`TOKENS`).
    *   Metrics to retrieve (`SENTIMENT_METRICS`, `OTHER_METRICS`).
    *   Date range for data (`START_DATE`, `END_DATE`).
    *   Default file paths for input data and output directories.
*   Factor definitions (`FACTOR_CONFIGS`) and return period definitions (`RETURN_CONFIGS`) are located in <mcfile name="main.py" path="/Users/queenwen/Desktop/whale_effect/main.py"></mcfile>.

## Output Description

The project generates various outputs, primarily stored in the following directories:

*   `intermediate_steps/`: Intermediate CSV files generated by <mcfile name="analysisagent.py" path="/Users/queenwen/Desktop/whale_effect/analysisagent.py"></mcfile> during data processing and factor construction.
*   `factor_validation_outputs/`:
    *   CSV summaries of IC and quantile analysis.
    *   IC time series plots, quantile return plots, and summary table plots for each factor.
    *   Regression analysis results generated by <mcfile name="trading_strategy_agent.py" path="/Users/queenwen/Desktop/whale_effect/trading_strategy_agent.py"></mcfile> (CSV files, coefficient plots, R² plots, summary heatmaps, etc.).
*   `multifactor_strategy_outputs/`:
    *   CSV summaries of backtest performance metrics.
    *   Net value curve plots for different strategies and factors.

The main merged data file is typically `analysis_results.csv` located in the project root directory (or specified via parameters).

## Contribution Guidelines

Contributions to this project are welcome! If you have any suggestions for improvements or find any issues, feel free to create an Issue or submit a Pull Request.